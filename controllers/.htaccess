# Protect controllers from direct browser access
# But allow AJAX requests and form submissions

# Block direct access via browser (GET requests without proper headers)
<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # Allow if it's a POST request (form submissions)
    RewriteCond %{REQUEST_METHOD} POST
    RewriteRule ^ - [L]
    
    # Allow if it's an AJAX request (has X-Requested-With header)
    RewriteCond %{HTTP:X-Requested-With} =XMLHttpRequest
    RewriteRule ^ - [L]
    
    # Allow if accessed from same domain (has valid Referer)
    RewriteCond %{HTTP_REFERER} ^https?://(www\.)?trainhub\.web\.id [NC,OR]
    RewriteCond %{HTTP_REFERER} ^https?://localhost [NC]
    RewriteRule ^ - [L]
    
    # Block everything else (direct GET requests)
    RewriteRule ^.*$ - [F,L]
</IfModule>

# Fallback for servers without mod_rewrite
<IfModule !mod_rewrite.c>
    # Deny all direct access
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Deny from all
    </IfModule>
</IfModule>
