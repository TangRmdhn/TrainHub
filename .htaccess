RewriteEngine On

# 0. Protect sensitive PHP files from direct URL access
<FilesMatch "^(koneksi|config)\.php$">
    <IfModule mod_authz_core.c>
        Require all denied
    </IfModule>
    <IfModule !mod_authz_core.c>
        Order deny,allow
        Deny from all
    </IfModule>
</FilesMatch>

# 1. Allow existing files and directories (Critical for assets)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2. Force HTTPS (Production Only)
# Checks if the host is trainhub.web.id AND HTTPS is off
RewriteCond %{HTTP_HOST} ^(www\.)?trainhub\.web\.id [NC]
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 3. Specific Routing (Map clean URLs to actual files)

# Auth & App Views
RewriteRule ^login/?$ views/login.php [L]
RewriteRule ^register/?$ views/register.php [L]
RewriteRule ^app/?$ views/app.php [L]
RewriteRule ^calendar/?$ views/calendar.php [L]
RewriteRule ^stats/?$ views/stats.php [L]
RewriteRule ^ai-coach/?$ views/ai-coach.php [L]
RewriteRule ^plans/?$ views/plans.php [L]
RewriteRule ^screening/?$ views/screening.php [L]
RewriteRule ^about/?$ views/about.php [L]
RewriteRule ^changelog/?$ views/changelog.php [L]

# Controllers (Shortcuts if needed, mostly for logout)
RewriteRule ^logout/?$ controllers/logout.php [L]

# 4. General "Pretty URL" Fallback
# If a file exists in root with .php extension, use it (e.g. index.php)
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^([^\.]+)$ $1.php [NC,L]

# 5. Handle 404 (Optional, but good practice)
# ErrorDocument 404 /trainhub/views/404.php